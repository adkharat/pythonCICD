pipeline {

   agent any
   
    // stages {
    //     stage('Test') {
    //         steps {
    //             script { 
    //                 docker.image('node:12.16.2').run('-d -p 3000:3000')  
    //                 } 
    //             sh 'node --version'
    //         }
    //     }
    // }

    // agent any

    stages {

        stage('CleanWorkspace and Clone') {
            steps {
                sh 'uname -a'

                cleanWs()
                echo 'Workspace cleaned /var/lib/jenkins/workspace'

                checkout scm 
                echo 'Code clone in Workspace /var/lib/jenkins/workspace'

                echo 'Python and Pip version '
                sh 'python3 --version'
                sh 'command -v pip3 || (sudo apt-get update && sudo apt-get install -y python3-pip)'
                sh 'pip3 --version'
            }
        }

        stage('Setup Python Environment and Dependench Installation') {
            steps {
                script {
                    // Create a virtual environment
                    sh 'python3 -m venv venv'

                    // Activate the virtual environment and install requirements
                    sh '''
                    . ./venv/bin/activate
                    pip3 install -r requirements.txt
                    '''
                }
            }
        }

        stage('Build') {
            steps {
                    // Activate the virtual environment and install requirements
                    sh '''
                    . ./venv/bin/activate
                    python3 lambda-dunction.py
                    '''
            }
        }
    } 
}